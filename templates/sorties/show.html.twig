{% extends 'base.html.twig' %}

{% block title %}Sorties{% endblock %}

{% block body %}
    <h1 class="d-flex justify-content-center">Sorties</h1>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <table class="table">
                    <tbody>
                    <tr>
                        <th>Nom</th>
                        <td>{{ sortie.nom }}</td>
                    </tr>
                    <tr>
                        <th>Date de Début</th>
                        <td>{{ sortie.dateDebut ? sortie.dateDebut|date('d-m-Y H:i') : '' }}</td>
                    </tr>
                    <tr>
                        <th>Date de Fin</th>
                        <td>{{ sortie.dateFin ? sortie.dateFin|date('d-m-Y H:i') : '' }}</td>
                    </tr>
                    <tr>
                        <th>Durée (minutes)</th>
                        <td>{{ sortie.duree }}</td>
                    </tr>
                    <tr>
                        <th>Nombre d'inscrits</th>
                        <td>{{ cpt }}/{{ sortie.nbInscriptionsMax }}</td>
                    </tr>
                    <tr>
                        <th>Description</th>
                        <td>{{ sortie.descriptionInfos }}</td>
                    </tr>

                    <tr>
                        <th>État de la Sortie</th>
                        <td>{{ sortie.noEtat.libelle }}</td>
                    </tr>
                    <tr>
                        <th>Photo</th>
                        <td>
                            {% if sortie.urlPhoto %}
                                <img src="{{ sortie.urlPhoto }}" alt="Photo de la sortie" class="img-fluid"/>
                            {% else %}
                                Aucune photo disponible.
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Date limite d'inscription</th>
                        <td>{{ sortie.dateClotureInscription ? sortie.dateClotureInscription|date('d-m-Y H:i') : '' }}</td>
                    </tr>
                    </tbody>
                </table>

                <div class="d-flex justify-content-center">
                    {% if sortie.noEtat.libelle == 'Créée' %}
                        <a href="{{ path('app_sorties_publication', {'id': sortie.id} ) }}"
                           class="btn btn-success ms-2">Publier</a>
                    {% endif %}
                    <a href="{{ path('app_sorties_index') }}" class="btn btn-primary ms-2">Liste des sorties</a>

                </div>

                <h2>Liste des participants</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Pseudo</th>
                        <th>Nom</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% if inscriptions is not empty %}
                        {% for inscription in inscriptions %}
                            <tr>
                                <td>{{ inscription.noParticipant.pseudo }}</td>
                                <td>{{ inscription.noParticipant.nom }}</td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="2">Aucun participant</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center mt-4">
        <a href="{{ path('app_sorties_index') }}" class="btn btn-primary ms-2">Liste des sorties</a>
        <a href="{{ path('app_sorties_edit', {'id': sortie.id}) }}" class="btn btn-success ms-2">Modifier</a>

        {# Affichage conditionnel des boutons d'inscription #}
        {% if isInscrit %}
            {# Bouton "Se désinscrire" visible seulement si l'utilisateur est inscrit #}
            <a href="{{ path('app_sorties_desinscription', {'id': sortie.id}) }}" class="btn btn-danger ms-2">Se désinscrire</a>
        {% elseif etat.libelle not in ['Clôturée', 'Annulée']
            and sortie.dateClotureInscription > 'now'|date('Y-m-d H:i:s')
            and cpt < sortie.nbInscriptionsMax %}
            {# Bouton "S'inscrire" visible seulement si l'utilisateur n'est pas inscrit,
                que la sortie est encore ouverte, que la date de clôture n'est pas dépassée,
                et que la limite des inscriptions n'est pas atteinte #}
            <a href="{{ path('app_sorties_inscription', {'id': sortie.id}) }}" class="btn btn-primary ms-2">S'inscrire</a>
        {% endif %}
    </div>
{% endblock %}
